<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layouts :: header}"></head>

<nav th:replace="~{layouts::navbar}"></nav>

<body>
    <br>
    <h2 class="text-center">Project Timelines</h2>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        var chartData = "[[${projectTimeList}]]";
        var chartDataDecoded = decodeHtml(chartData);

        if (!chartDataDecoded || chartDataDecoded.trim() === "null") {
            chartDataDecoded = "[]";
        }

        var chartJsonArray;
        try {
            chartJsonArray = JSON.parse(chartDataDecoded);
        } catch (error) {
            console.error("Invalid JSON format:", error);
            chartJsonArray = [];
        }

        var resultArray = [];

        for (var i = 0; i < chartJsonArray.length; i++) {
            var project = chartJsonArray[i];
            var projectName = project.projectName ? project.projectName : `Project ${i + 1}`;
            resultArray.push([
                projectName,
                new Date(project.startDate),
                new Date(project.endDate)
            ]);
        }

        google.charts.load('current', { packages: ['timeline'] });
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
            var container = document.getElementById('chart_div');
            var chart = new google.visualization.Timeline(container);
            var dataTable = new google.visualization.DataTable();

            dataTable.addColumn({ type: 'string', id: 'Project' });
            dataTable.addColumn({ type: 'date', id: 'Start' });
            dataTable.addColumn({ type: 'date', id: 'End' });

            dataTable.addRows(resultArray);
            chart.draw(dataTable);
        }

        function decodeHtml(html) {
            var txt = document.createElement("textarea");
            txt.innerHTML = html;
            return txt.value;
        }
    </script>
    <div id="chart_div"></div>
</body>
</html>